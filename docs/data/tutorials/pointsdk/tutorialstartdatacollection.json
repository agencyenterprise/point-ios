{"metadata":{"title":"Start Collecting Data","categoryPathComponent":"TutorialTableOfContents","role":"project","category":"PointSDK"},"hierarchy":{"modules":[{"reference":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/TutorialTableOfContents\/Basic-Steps","projects":[{"reference":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialGettingStarted","sections":[{"kind":"task","reference":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialGettingStarted#Setting-up-your-project"},{"kind":"task","reference":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialGettingStarted#Start-using-the-SDK"}]},{"reference":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialStartDataCollection","sections":[{"kind":"task","reference":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialStartDataCollection#Background-Listeners"},{"kind":"task","reference":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialStartDataCollection#Foreground-Listeners"}]},{"reference":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialHealthService","sections":[{"kind":"task","reference":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialHealthService#Getting-User-Data"},{"kind":"task","reference":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialHealthService#Getting-User-Metrics"}]}]}],"reference":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/TutorialTableOfContents","paths":[["doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/TutorialTableOfContents","doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/TutorialTableOfContents\/$volume","doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/TutorialTableOfContents\/Basic-Steps"]]},"schemaVersion":{"major":0,"minor":2,"patch":0},"kind":"project","identifier":{"url":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialStartDataCollection","interfaceLanguage":"swift"},"sections":[{"kind":"hero","title":"Start Collecting Data","chapter":"Basic Steps","estimatedTimeInMinutes":20,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Now that you have set up the SDK, authenticated your user, and already got the user past data in the device, it’s time to enable the data listeners to keep Point’s Health Service up to date with new samples."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"This is important to keep all generated metrics and insights updated and relevant."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Learn how to use Point HealthKit, the SDK service that integrates with Apple’s HealthKit to collect user Health data."}]}]},{"kind":"tasks","tasks":[{"anchor":"Background-Listeners","title":"Background Listeners","contentSection":[{"kind":"contentAndMedia","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"As Point Health Service generates some of the metrics and insights in a daily or weekly basis, it’s important to keep it as most updated as possibly to avoid generating them with missing data. This way, we cannot just rely on the user to periodically open his app so we can upload his Health data."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"For this, we can use background listeners, short lived tasks that run periodically in background (even when the app is closed) to upload new data."}]}],"mediaPosition":"trailing"}],"stepsSection":[{"code":null,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Our first step is allowing HealthKit’s background deliveries. Go back to your Project screen -> Select your Target -> Signing & Capabilities. In HealthKit, check the “Background Delivery” checkbox."}]}],"caption":[{"type":"paragraph","inlineContent":[{"type":"text","text":"This will allow HealthKit to wake up your app periodically when new samples are added. This happens when your app is in background or if it’s closed."}]}],"type":"step","runtimePreview":null,"media":"CheckBackgroundDelivery.png"},{"code":null,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Click in “+” to add a new capability. Look for “Background Modes” and add it."}]}],"caption":[],"type":"step","runtimePreview":null,"media":"BackgroundModes.png"},{"code":null,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Check the “Background Fetch” checkbox."}]}],"caption":[{"type":"paragraph","inlineContent":[{"type":"text","text":"This will enable us to fetch data when the app is backgrounded."}]}],"type":"step","runtimePreview":null,"media":"BackgroundFetch.png"},{"code":"TutorialCodeAppDelegate3.swift","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Go back to the AppDelegate. Create a Task and call "},{"type":"codeVoice","code":"Point.healthKit.startAllBackgroundListeners()"},{"type":"text","text":"."}]}],"caption":[{"type":"paragraph","inlineContent":[{"type":"text","text":"This will create and run Observer Queries that keep listening for HealthKit notification of new samples. Apple suggests running this on the App Delegate to make sure these queries are running every time your app is launched or waken up."}]}],"type":"step","runtimePreview":null,"media":null}]},{"anchor":"Foreground-Listeners","title":"Foreground Listeners","contentSection":[{"kind":"contentAndMedia","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Your app is now able to get data when it’s on background. Now, it’s time to enable the Foreground Listeners to get Health data in real time when your user is using your app."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Learn how to enable the foreground listeners and how to stop them when going to background."}]}],"mediaPosition":"trailing"}],"stepsSection":[{"code":"TutorialCodeViewController5.swift","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"In the ViewController, add a call to "},{"type":"codeVoice","code":"enableAllForegroundListeners"},{"type":"text","text":"."}]}],"caption":[{"type":"paragraph","inlineContent":[{"type":"text","text":"This will create long-running queries that listen for new samples and upload them while your app is in foreground. We are enabling them here to make sure that it happens after the user has granted permissions."}]}],"type":"step","runtimePreview":null,"media":null},{"code":"TutorialCodeAppDelegate4.swift","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Now, go back to the AppDelegate, in “applicationWillResignActive” call "},{"type":"reference","isActive":true,"identifier":"doc:\/\/co.areyouonpoint.app.PointSDK\/documentation\/PointSDK\/HealthKitManager\/stopAllForegroundListeners()"},{"type":"text","text":"."}]}],"caption":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The foreground listeners won’t run in background if you don’t stop them here, but we suggest doing this to avoid conflicts when bringing your app to foreground. Note that in this single view example we are enabling these listeners again every time the view is displayed in foreground."}]}],"type":"step","runtimePreview":null,"media":null},{"code":null,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Your app is now collecting all Health data that we need! Before continuing to the next tutorial, take some time to add some samples in Health or using a Watch device to see the data collection in action."}]}],"caption":[],"type":"step","runtimePreview":null,"media":"AppleHealth.png"}]}]},{"action":{"overridingTitleInlineContent":[{"type":"text","text":"Get started"}],"isActive":true,"type":"reference","identifier":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialHealthService","overridingTitle":"Get started"},"featuredEyebrow":"Tutorial","kind":"callToAction","title":"Use Point Health Service","abstract":[{"type":"text","text":"Your app is now collecting all Health data that we need. Although, this is only raw data. The real power of PointSDK is accessing Point Health Service, which processes the collected raw data to generate personalized metrics and insights."}]}],"references":{"doc://co.areyouonpoint.app.PointSDK/tutorials/TutorialTableOfContents":{"role":"overview","title":"Point SDK Tutorial","abstract":[{"type":"text","text":"Learn how to use PointSDK."}],"identifier":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/TutorialTableOfContents","kind":"overview","type":"topic","url":"\/tutorials\/tutorialtableofcontents"},"doc://co.areyouonpoint.app.PointSDK/tutorials/PointSDK/TutorialHealthService#Getting-User-Data":{"role":"pseudoSymbol","title":"Getting User Data","abstract":[{"type":"text","text":"Your app is now collecting all Health data that we need. Although, this is only raw data. The real power of PointSDK is accessing Point Health Service, which processes the collected raw data to generate personalized metrics and insights."}],"identifier":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialHealthService#Getting-User-Data","kind":"section","type":"section","url":"\/tutorials\/pointsdk\/tutorialhealthservice#Getting-User-Data"},"doc://co.areyouonpoint.app.PointSDK/tutorials/TutorialTableOfContents/Basic-Steps":{"role":"article","title":"Basic Steps","abstract":[],"identifier":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/TutorialTableOfContents\/Basic-Steps","kind":"article","type":"topic","url":"\/tutorials\/tutorialtableofcontents\/basic-steps"},"doc://co.areyouonpoint.app.PointSDK/tutorials/PointSDK/TutorialStartDataCollection#Foreground-Listeners":{"role":"pseudoSymbol","title":"Foreground Listeners","abstract":[{"type":"text","text":"Now that you have set up the SDK, authenticated your user, and already got the user past data in the device, it’s time to enable the data listeners to keep Point’s Health Service up to date with new samples."}],"identifier":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialStartDataCollection#Foreground-Listeners","kind":"section","type":"section","url":"\/tutorials\/pointsdk\/tutorialstartdatacollection#Foreground-Listeners"},"doc://co.areyouonpoint.app.PointSDK/tutorials/PointSDK/TutorialGettingStarted":{"role":"project","title":"Getting Started","estimatedTime":"20min","abstract":[{"type":"text","text":"Learn the first steps to start using Point SDK."}],"identifier":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialGettingStarted","kind":"project","type":"topic","url":"\/tutorials\/pointsdk\/tutorialgettingstarted"},"doc://co.areyouonpoint.app.PointSDK/tutorials/PointSDK/TutorialGettingStarted#Start-using-the-SDK":{"role":"pseudoSymbol","title":"Start using the SDK","abstract":[{"type":"text","text":"Learn the first steps to start using Point SDK."}],"identifier":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialGettingStarted#Start-using-the-SDK","kind":"section","type":"section","url":"\/tutorials\/pointsdk\/tutorialgettingstarted#Start-using-the-SDK"},"doc://co.areyouonpoint.app.PointSDK/tutorials/PointSDK/TutorialHealthService":{"role":"project","title":"Use Point Health Service","estimatedTime":"20min","abstract":[{"type":"text","text":"Your app is now collecting all Health data that we need. Although, this is only raw data. The real power of PointSDK is accessing Point Health Service, which processes the collected raw data to generate personalized metrics and insights."}],"identifier":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialHealthService","kind":"project","type":"topic","url":"\/tutorials\/pointsdk\/tutorialhealthservice"},"TutorialCodeAppDelegate3.swift":{"syntax":"swift","content":["import UIKit","import PointSDK","","@main","class AppDelegate: UIResponder, UIApplicationDelegate {","    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {","        Point.verbose = true","        Point.setup(","            clientId: \"PointReferenceId\",","            clientSecret: \"PointReferenceSecret\",","            queryTypes: Set(HealthQueryType.allCases),","            environment: .development)","        Task {","            await Point.healthKit?.startAllBackgroundListeners()","        }","        return true","    }","    \/\/Other AppDelegateFunctions","}"],"fileName":"AppDelegate.swift","identifier":"TutorialCodeAppDelegate3.swift","type":"file","fileType":"swift","highlights":[{"line":13},{"line":14},{"line":15}]},"TutorialCodeAppDelegate4.swift":{"syntax":"swift","content":["import UIKit","import PointSDK","","@main","class AppDelegate: UIResponder, UIApplicationDelegate {","    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {","        Point.verbose = true","        Point.setup(","            clientId: \"PointReferenceId\",","            clientSecret: \"PointReferenceSecret\",","            queryTypes: Set(HealthQueryType.allCases),","            environment: .development)","        Task {","            await Point.healthKit?.startAllBackgroundListeners()","        }","        return true","    }","","    func applicationWillResignActive(_ application: UIApplication) {","        Point.healthKit?.stopAllForegroundListeners()","    }","    \/\/Other AppDelegateFunctions","}"],"fileName":"AppDelegate.swift","identifier":"TutorialCodeAppDelegate4.swift","type":"file","fileType":"swift","highlights":[{"line":18},{"line":19},{"line":20},{"line":21}]},"BackgroundFetch.png":{"alt":"The image shows the Background Fetch checkbox selected under the Background Modes capability section.","type":"image","identifier":"BackgroundFetch.png","variants":[{"url":"\/images\/BackgroundFetch.png","traits":["1x","light"]}]},"doc://co.areyouonpoint.app.PointSDK/tutorials/PointSDK/TutorialHealthService#Getting-User-Metrics":{"role":"pseudoSymbol","title":"Getting User Metrics","abstract":[{"type":"text","text":"Your app is now collecting all Health data that we need. Although, this is only raw data. The real power of PointSDK is accessing Point Health Service, which processes the collected raw data to generate personalized metrics and insights."}],"identifier":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialHealthService#Getting-User-Metrics","kind":"section","type":"section","url":"\/tutorials\/pointsdk\/tutorialhealthservice#Getting-User-Metrics"},"doc://co.areyouonpoint.app.PointSDK/documentation/PointSDK/HealthKitManager/stopAllForegroundListeners()":{"role":"symbol","title":"stopAllForegroundListeners()","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"stopAllForegroundListeners"},{"kind":"text","text":"()"}],"abstract":[{"type":"text","text":"Stops all active foreground listeners."}],"identifier":"doc:\/\/co.areyouonpoint.app.PointSDK\/documentation\/PointSDK\/HealthKitManager\/stopAllForegroundListeners()","kind":"symbol","required":true,"type":"topic","url":"\/documentation\/pointsdk\/healthkitmanager\/stopallforegroundlisteners()"},"doc://co.areyouonpoint.app.PointSDK/tutorials/PointSDK/TutorialStartDataCollection":{"role":"project","title":"Start Collecting Data","estimatedTime":"20min","abstract":[{"type":"text","text":"Now that you have set up the SDK, authenticated your user, and already got the user past data in the device, it’s time to enable the data listeners to keep Point’s Health Service up to date with new samples."}],"identifier":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialStartDataCollection","kind":"project","type":"topic","url":"\/tutorials\/pointsdk\/tutorialstartdatacollection"},"BackgroundModes.png":{"alt":"The image shows a the capability search screen, with the 'Background Mode' capability selected","type":"image","identifier":"BackgroundModes.png","variants":[{"url":"\/images\/BackgroundModes.png","traits":["1x","light"]}]},"AppleHealth.png":{"alt":"A image showing Apple's Health App in the Browse tab.","type":"image","identifier":"AppleHealth.png","variants":[{"url":"\/images\/AppleHealth.png","traits":["1x","light"]}]},"doc://co.areyouonpoint.app.PointSDK/tutorials/PointSDK/TutorialStartDataCollection#Background-Listeners":{"role":"pseudoSymbol","title":"Background Listeners","abstract":[{"type":"text","text":"Now that you have set up the SDK, authenticated your user, and already got the user past data in the device, it’s time to enable the data listeners to keep Point’s Health Service up to date with new samples."}],"identifier":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialStartDataCollection#Background-Listeners","kind":"section","type":"section","url":"\/tutorials\/pointsdk\/tutorialstartdatacollection#Background-Listeners"},"CheckBackgroundDelivery.png":{"alt":"The image shows the 'Signing & Capabilities' screen of the main Target. The 'Background Delivery' checkbox under HealthKit session is enabled","type":"image","identifier":"CheckBackgroundDelivery.png","variants":[{"url":"\/images\/CheckBackgroundDelivery.png","traits":["1x","light"]}]},"doc://co.areyouonpoint.app.PointSDK/tutorials/PointSDK/TutorialGettingStarted#Setting-up-your-project":{"role":"pseudoSymbol","title":"Setting up your project","abstract":[{"type":"text","text":"Learn the first steps to start using Point SDK."}],"identifier":"doc:\/\/co.areyouonpoint.app.PointSDK\/tutorials\/PointSDK\/TutorialGettingStarted#Setting-up-your-project","kind":"section","type":"section","url":"\/tutorials\/pointsdk\/tutorialgettingstarted#Setting-up-your-project"},"TutorialCodeViewController5.swift":{"syntax":"swift","content":["import UIKit","import PointSDK","","class ViewController: UIViewController {","    override func viewDidLoad() {","        super.viewDidLoad()","    }","","    override func viewDidAppear(_ animated: Bool) {","        Task {","            do {","                try await Point.healthKit?.requestAuthorizationsIfPossible()","            } catch {","                print(\"Error requesting authorizations: \\(error)\")","            }","","            do {","                try await Point.setUserToken(accessToken: self.getUserToken())","            } catch {","                print(\"Error setting the user token or fetching user past data: \\(error)\")","            }","","            do {","                let _ = try await Point.healthKit?.enableAllForegroundListeners()","            } catch {","                print(\"Error enabling foreground listeners: \\(error)\")","            }","        }","    }","}","","extension ViewController {","    func getUserToken() -> String {","        return \"ReplaceThisWithYourToken\"","    }","}"],"fileName":"ViewController.swift","identifier":"TutorialCodeViewController5.swift","type":"file","fileType":"swift","highlights":[{"line":24},{"line":26}]}}}